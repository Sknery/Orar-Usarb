server {
    # Nginx будет слушать на порту 80 внутри контейнера
    listen 80;
    server_name localhost;

    # Корень, где лежат собранные файлы
    root /usr/share/nginx/html;
    index index.html index.htm;

    # --- ЧАСТЬ 1 ---
    # Эта часть отдает React-приложение (index.html)
    # на любой запрос, который не является файлом
    location / {
        try_files $uri $uri/ /index.html;
    }

    # --- ЧАСТЬ 2: НОВЫЙ КОД ДЛЯ API-ПРОКСИ ---
    # Эта часть перехватывает все запросы, начинающиеся с /api/
    location /api/ {
        # 1. Убираем /api/ из пути (т.к. бэкенд его не ожидает)
        # /api/schedule -> /schedule
        rewrite ^/api/(.*)$ /$1 break;
        
        # 2. Перенаправляем запрос на бэкенд-сервис
        # 'schedule-api' - это имя сервиса из твоего docker-compose.yml
        # '3000' - это порт, который бэкенд слушает ВНУТРИ Docker-сети
        proxy_pass http://schedule-api:3000;
        
        # 3. Стандартные заголовки для прокси
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Обработка ошибок
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}